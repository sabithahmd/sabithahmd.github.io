<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qatar KMCC Campaign</title>
  <link rel="stylesheet" href="https://unpkg.com/cropperjs/dist/cropper.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .row {
      display: flex;
    }
    .my-15 {
      margin-top: 15px;
      margin-bottom: 15px;
    }
    .container {
      width: 450px;
      margin: auto;
      text-align: center;
    }
    #uploadInput {
      margin-bottom: 20px;
    }
    #cropperCanvas {
      max-width: 100%;
      cursor: crosshair;
      width: 100%;
    }
    #cropButton {
      margin-top: 20px;
      display: none;
    }
    #downloadButton {
      margin-top: 20px;
      display: none;
    }

    .inputfile {
    display: none;
}

/* Style the label to act as a button */
.uploadButton {
    display: inline-block;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    color: #fff;
    background-color: #059d3f;
    border: 2px solid #026d2b;
    border-radius: 5px;
    cursor: pointer;
}

/* Change button style on hover for better user feedback */
.uploadButton:hover {
    background-color: #026d2b;
    border: 2px solid #059d3f;
}

#nameField {
  height: 50px;
  width: 350px;
  margin: 5px;
  border-radius: 10px;
  padding: 3px 10px;
  border: 1px solid #059d3f;
  color: #059d3f;
  font-size: 23px;
}

    @media (min-width: 768px) {
      /* Adjust styles for medium-sized screens and larger */
      #cropperCanvas {
        max-width: 680px; /* Set a maximum width for better visibility */
        margin: auto; /* Center the canvas */
      }
    }

    @media (max-width: 450px) {
      .container {
        width: 100%;
        margin: auto;
        text-align: center;
      }
    }

    
  </style>
</head>
<body>

 
  <div class="container">
    <img style="width:150px;" src="https://www.kmccqatar.com/gallery/KMCC%20qatar-ts1634555751.svg" data-original-width="669.48" data-original-height="669.48">
    <div id="nameDiv" class="my-15">
      <input type="text" placeholder="Your Name" id="nameField">
    </div>
    <div id="photoDiv" class="my-15">
      <input type="file" id="uploadInput" accept="image/*" class="inputfile" />
      <label for="uploadInput" class="uploadButton">Choose Photo</label>
    </div>
    <canvas id="cropperCanvas" width="1500" height="1644"></canvas>
    <button id="cropButton" class="uploadButton">Crop</button>
    <br>
    <div>
      <button class="uploadButton" id="downloadButton" onclick="downloadImage()">Download</button>
    </div>
  </div>

  <script src="https://unpkg.com/cropperjs"></script>
  <script>
    const uploadInput = document.getElementById('uploadInput');
    const cropperCanvas = document.getElementById('cropperCanvas');
    const cropButton = document.getElementById('cropButton');
    const downloadButton = document.getElementById('downloadButton');
    const nameDiv = document.getElementById('nameDiv');
    const photoDiv = document.getElementById('photoDiv');
    let cropper;

    uploadInput.addEventListener('change', handleFileSelect);
    cropButton.addEventListener('click', handleCrop);

    function handleFileSelect(event) {
      const file = event.target.files[0];

      if (file) {
        const reader = new FileReader();

        reader.onload = function (e) {
          const img = new Image();

          img.onload = function () {
            // Initialize Cropper.js
            if (cropper) {
              cropper.destroy();
            }

            cropper = new Cropper(cropperCanvas, {
              aspectRatio: 1,
              viewMode: 2,
              autoCropArea: 1,
              background: false,
              ready: function () {
                // Display the "Crop Image" button after Cropper.js is ready
                cropButton.style.display = 'inline-block';
              }
            });

            // Set the background image for Cropper.js
            cropper.replace(img.src);
          };

          img.src = e.target.result;
        };

        reader.readAsDataURL(file);
      }
    }

    function handleCrop() {
      // Get the cropped data URL from Cropper.js
      const croppedCanvas = cropper.getCroppedCanvas({ width: 680, height: 680 });

      // Destroy the Cropper.js instance to hide the cropper interface
      cropper.destroy();

      // Show the "Download Final Image" button
      downloadButton.style.display = 'inline-block';
      
      // Hide the "Crop Image" button
      cropButton.style.display = 'none';

      // In a complete implementation, you might want to handle errors and edge cases
      const ctx2 = cropperCanvas.getContext('2d');

      // Clear the canvas
      ctx2.clearRect(0, 0, cropperCanvas.width, cropperCanvas.height);

      // Draw the background image
      const bgImage = new Image();
      bgImage.onload = function() {
        ctx2.drawImage(bgImage, 0, 0, 1500, 1644);

        let textToWrite = document.getElementById("nameField").value;

        if(textToWrite !== "")
        {
          ctx2.font = "bold 53px Arial";
          ctx2.fillStyle = "white";
          ctx2.textAlign = "center";
          ctx2.fillText(textToWrite, 1086, 1510);
        }
      };
      bgImage.src = 'kmcc_6.png';

      // Draw the cropped image on top
      const croppedDataURL = croppedCanvas.toDataURL('image/png');
      console.log(croppedDataURL);
      const croppedImage = new Image();

      croppedImage.onload = function () {
        ctx2.drawImage(croppedImage, 750, 750, 680, 680);
      };

      croppedImage.src = croppedDataURL;
      nameDiv.style.display = 'none';
      photoDiv.style.display = 'none';

    }

    function downloadImage() {
      const dataUrl = cropperCanvas.toDataURL('image/png');
      const link = document.createElement('a');
      link.href = dataUrl;
      link.download = 'beypore_chc.png';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>

</body>
</html>
